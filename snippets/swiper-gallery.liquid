<style>
    .gallery-swipper {
      /* Classe vazia, apenas para marcação do Swiper */
    }

    .thumb-active {
      border-color: #000 !important;
      border-width: 2px !important;
    }

    .thumb {
      transition: all 0.2s ease;
      border: 1px solid #D0D5DE;
    }

    .swiper-button-next {
      margin-right: 32px;
    }
    .swiper-button-prev {
      margin-left: 32px;
    }

    .swiper-button-next,
    .swiper-button-prev {
        {% comment %} display: none!important; {% endcomment %}
        display: flex!important;
    }
</style>

<!-- Swiper principal -->
<div class="swiper gallery-swipper tw-rounded-[12px] tw-overflow-hidden
  lg:tw-w-full 
  lg:tw-max-w-[750px] 
  lg:tw-h-[550px] 
  lg:tw-bg-[#f5f5f7] 
  lg:tw-mb-4

  max-lg:tw-relative
  max-lg:tw-w-screen
  max-lg:tw-left-1/2
  max-lg:tw-ml-[-50vw]
  max-lg:tw-mr-[-50vw]
  max-lg:tw-max-w-none
  max-lg:tw-h-[320px] 
  max-lg:tw-bg-[#f5f5f7] 
  max-lg:tw-mb-4
  tw-relative
">
{% comment %} <div class="tw-absolute tw-top-0 tw-left-0 tw-w-[30px] tw-h-[30px] tw-flex tw-items-center tw-justify-center tw-bg-[red]">
    <span>-</span>
</div> {% endcomment %}

  <div class="swiper-wrapper">
   
    {% for image in product.images %}
        {% comment %} <div class="swiper-slide "> {% endcomment %}
      <div class="swiper-slide tw-flex tw-items-center tw-justify-center tw-p-[40px]">
        
        <img 
          src="{{ image | image_url: width: 1000 }}" 
          alt="{{ image.alt | escape }}" 
          class="tw-w-full tw-h-full tw-object-contain tw-max-w-full tw-max-h-full"
          loading="lazy"
          width=""
          height=""
        />
      </div>
    {% endfor %}
  </div>

  <!-- Pagination -->
  <div class="swiper-pagination"></div>

  <!-- Navigation arrows -->
  <div class="swiper-button-prev"></div>
  <div class="swiper-button-next"></div>
</div>

<!-- Thumbnails -->

<div class="tw-flex tw-gap-[8px] tw-justify-center tw-items-center tw-mt-4">
  {% for image in product.images %}
    <div 
      class="thumb tw-w-[60px] tw-h-[60px] tw-rounded-[6px] tw-overflow-hidden tw-cursor-pointer hover:tw-opacity-80"
      data-index="{{ forloop.index0 }}"
    >
      <img 
        src="{{ image | image_url: width: 60 }}" 
        alt="{{ image.alt | escape }}" 
        class="tw-w-full tw-h-full tw-object-cover"
        draggable="false"
        width=""
        height=""
      />
    </div>
  {% endfor %}
</div>

  <script>
    function initGallery() {
      if (typeof Swiper === 'undefined') {
        return;
      }

      const swiperElement = document.querySelector('.gallery-swipper');
      const thumbs = document.querySelectorAll('.thumb');

      if (!swiperElement) {
        return;
      }

      // Inicializar Swiper
      const swiper = new Swiper('.gallery-swipper', {
        loop: true,
        speed: 300,
        pagination: {
          el: '.swiper-pagination',
          clickable: true,
        },
        navigation: {
          nextEl: '.swiper-button-next',
          prevEl: '.swiper-button-prev',
        },
        on: {
          init: function () {
            updateActiveThumbnail(this.realIndex);
          },
          slideChange: function () {
            updateActiveThumbnail(this.realIndex);
          }
        }
      });

      // Função para atualizar thumbnail ativa
      function updateActiveThumbnail(activeIndex) {
        thumbs.forEach((thumb, index) => {
          thumb.classList.remove('thumb-active');
          if (index === activeIndex) {
            thumb.classList.add('thumb-active');
          }
        });
      }

      // Event listeners para thumbnails
      thumbs.forEach((thumb, index) => {
        thumb.addEventListener('click', function(e) {
          e.preventDefault();
          const clickedIndex = parseInt(this.getAttribute('data-index'));

          try {
            swiper.slideToLoop(clickedIndex, 300);
          } catch (error) {
            swiper.slideTo(clickedIndex);
          }
        });
      });

      // Definir primeira thumbnail como ativa
      if (thumbs.length > 0) {
        thumbs[0].classList.add('thumb-active');
      }
    }

    // Inicializar gallery
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initGallery);
    } else {
      if (typeof Swiper !== 'undefined') {
        initGallery();
      } else {
        window.addEventListener('load', initGallery);
      }
    }
  </script>